<html><html><head><meta charset="UTF-8" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link href="https://exp2exp.github.io/static/css/firn_base.css" rel="stylesheet" /></head></html><body><main><article class="content"><h1>Hypernotebook First Demo</h1><div><div><section><p><span>First demo notes will go here.</span></p></section><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="during-our-first-session-on-this,-we-set-up-a-calculator"><span class="firn-headline-text"><span>During our first session on this, we set up a calculator</span></span></h1><section><p><span>We wrote up a configuration, starting from what the </span><code>src</code><span> block might
look like:</span></p><ul><li><p><code>:process</code><span> stands in for </span><code>:session</code><span> now as an alternative</span></p></li><li><p><code>org-babel-execute-src-block</code><span> this is the function that will be called</span></p></li><li><p><span>We saw we had to hang into the </span><code>lang</code><span> parameter of the above function, but override using </span><code>:process</code></p></li><li><p><span>The variable </span><code>org-stream-output</code><span> needs to be defined (it's in our </span><code>ob-stream.el</code><span>).</span></p></li><li><p><span>The function </span><code>org-babel-stream</code><span> needs to be defined as well (it's in our </span><code>ob-stream.el</code><span>).</span></p></li><li><p><span>If you're going to use a language mode like </span><code>calc</code><span> it should be required.</span></p></li><li><p><span>The process itself needs to be defined as well.</span></p></li><li><p><code>(setq org-confirm-babel-evaluate nil)</code><span> should be set.</span></p></li></ul><p><span>This is an example of what we came up with:</span></p><p><code>#+begin_src calc :stream calculator :results output org</code></p><pre class="language-calc"><code class="language-calc">10*8
</code></pre><pre class="language-org"><code class="language-org">80
</code></pre></section></div><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="background-research"><span class="firn-headline-text"><span>Background research</span></span></h1><section><p><span>We took a good look at emacs-jupyter to understand how it works.
It seems to work reasonably well but not able to do all the hops via TRAMP to connect with a notebook running on Google Cloud.  This is documented as bug #191 in the emacs-jupyter repo.</span></p></section></div><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="now-we-wanted-to-improve-this-to-make-it-more-robust"><span class="firn-headline-text"><span>Now we wanted to improve this to make it more robust</span></span></h1><section><ul><li><p><span>Be able to handle multiple backends (now via "servants" for different shell commands and potentially other processes), not just the </span><code>bc</code><span> calculator!</span></p></li><li><p><span>In the first version we just used a variable to store things, now use a hash table to organise the data better (</span><code>org-babel-servant-info</code><span>)</span></p></li><li><p><span>Generalise everything</span></p></li></ul></section></div><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="stitching-things-together"><span class="firn-headline-text"><span>Stitching things together</span></span></h1><section><ul><li><p><span>Find a good way to weave </span><code>org-babel-servant</code><span> into </span><code>org-babel-execute-src-block</code></p></li><li><p><span>Organise the callbacks, can we demo it calling Maxima?</span></p></li></ul></section><div class="firn-headline-section firn-headline-section-2"><h2 class="firn-headline firn-headline-2" id="getting-things-going"><span class="firn-headline-text"><span>Getting things going</span></span></h2><section><pre class="language-emacs-lisp"><code class="language-emacs-lisp">;; Here we start the process
(get-buffer-create "maxima-error")
(setq maxima-proc
      (make-process
       :name "maxima-proc"
       :command '("maxima" "--very-quiet") ;; if we need parameters can add here
       :stderr "maxima-error"
       :filter #'org-stream-string-callback))

(setq calculator-proc
      (make-process
       :name "calculator-proc"
       :command '("bc" "-q") ;; if we need parameters can add here
       ;; :stderr "maxima-error"
       :filter #'org-stream-number-callback))
</code></pre></section><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="calculator-example-again"><span class="firn-headline-text"><span>Calculator example again</span></span></h3><section><pre class="language-calc"><code class="language-calc">10+1
</code></pre><pre class="language-org"><code class="language-org">10
</code></pre></section></div><div class="firn-headline-section firn-headline-section-3"><h3 class="firn-headline firn-headline-3" id="maxima-example"><span class="firn-headline-text"><span>Maxima example</span></span></h3><section><p><span>Here we call the process we just started.</span></p><pre class="language-exp"><code class="language-exp">3+600000000;
</code></pre><pre class="language-org"><code class="language-org">600000003
</code></pre><pre class="language-exp"><code class="language-exp">display2d:false;
</code></pre><pre class="language-org"><code class="language-org">false
</code></pre><pre class="language-exp"><code class="language-exp">expand((x+1)^9)
</code></pre><pre class="language-org"><code class="language-org">$$x^9+9\,x^8+36\,x^7+84\,x^6+126\,x^5+126\,x^4+84\,x^3+36\,x^2+9\,x+1$$
</code></pre><pre class="language-exp"><code class="language-exp">expand((x+1)^1)
</code></pre><pre class="language-org"><code class="language-org">$$x+1$$
</code></pre></section></div></div></div><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="ob-servant-example"><span class="firn-headline-text"><span>Ob-servant example</span></span></h1><div class="firn-headline-section firn-headline-section-2"><h2 class="firn-headline firn-headline-2" id="calculator-example-again"><span class="firn-headline-text"><span>Calculator example again</span></span></h2><section><pre class="language-calc"><code class="language-calc">10+1
</code></pre><pre class="language-org"><code class="language-org">11
</code></pre></section></div></div><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="next-steps"><span class="firn-headline-text"><span>Next steps</span></span></h1><section><ul><li><p><span>Change the formatting of the output so it doesn't come across as a table</span></p></li><li><p><span>Carry on with ob-servant to integrate it (improve calling Maxima, errors)</span></p></li><li><p><span>Raise the change with the Org maintainers</span></p></li><li><p><span>Package it up! (patch + repo?)</span></p></li><li><p><span>5 minute talk for Emacs New York (Monday 2 November 2020).</span></p></li></ul></section></div><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="social-networking"><span class="firn-headline-text"><span>Social Networking</span></span></h1><section><ul><li><p><span>Talk with Fermin to understand what he's doing with Maxima and see if we need to do anything differently</span></p></li></ul></section></div><div class="firn-headline-section firn-headline-section-1"><h1 class="firn-headline firn-headline-1" id="final-polishing"><span class="firn-headline-text"><span>Final polishing</span></span></h1><section><ul><li><p><span>Consider renaming it to ob-servent!</span></p></li></ul></section></div></div></div><div><hr /><div class="backlinks"><h4>Backlinks to this document:</h4><ul class="firn-backlinks"><li class="firn-backlink"><a href="https://exp2exp.github.io/20200905125342-emacs_hyper_notebook">Emacs Hyper Notebook</a></li></ul></div></div></article></main></body></html>